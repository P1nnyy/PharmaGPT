version: '3.8'

services:
  # Neo4j Database
  neo4j:
    image: neo4j:4.4
    ports:
      - "7474:7474" # HTTP
      - "7687:7687" # Bolt
    environment:
      NEO4J_AUTH: neo4j/${NEO4J_PASSWORD:-password}
      NEO4J_dbms_memory_heap_initial__size: 512m
      NEO4J_dbms_memory_heap_max__size: 1G
    volumes:
      - ./data/neo4j:/data

  # Node.js Gateway / Frontend Dev Server
  # (Assuming frontend is served via Vite Dev Server for now based on conversation)
  frontend:
    build: 
      context: .
      dockerfile: Dockerfile
    command: npm run dev
    ports:
      - "5173:5173"
      - "8000:8000" # If Gateway runs here
    volumes:
      - .:/app
      - /app/node_modules
    environment:
      - VITE_API_BASE_URL=http://localhost:5001
      - VITE_CLERK_PUBLISHABLE_KEY=${VITE_CLERK_PUBLISHABLE_KEY} 

  # Python AI Backend
  backend:
    build: 
      context: .
      dockerfile: Dockerfile # You might need a separate Dockerfile.backend
    command: python -m src.api.server
    ports:
      - "5001:5001"
    volumes:
      - .:/app
    environment:
      - NEO4J_URI=bolt://neo4j:7687
      - NEO4J_USER=neo4j
      - NEO4J_PASSWORD=${NEO4J_PASSWORD:-password}
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}
      
      # --- OAuth Configuration ---
      - GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID}
      - GOOGLE_CLIENT_SECRET=${GOOGLE_CLIENT_SECRET}
      - SECRET_KEY=${SECRET_KEY}
      - FRONTEND_URL=http://localhost:5173
    depends_on:
      - neo4j
